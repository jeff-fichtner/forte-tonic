<!DOCTYPE html>
<html>
  <head>
    <?!= include('css/libraries'); ?>

    <?!= include('js/libraries'); ?>
    <?!= include('js/formComponents'); ?>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <style>
      li.delete-lesson-icon, li.add-lesson-icon {
        cursor: pointer;
      }
    </style>

    <script>
      const currentStudentId = "1";
      initialize();

      $(() => {
        const $instruments = $('select').formSelect();
        $instruments.on(
          'change',
          function() {
            const $item = $(this);
            google.script.run
              .withSuccessHandler(displayLessons)
              // .withFailureHandler(showLessonError)
              .loadLessonsForInstrument(currentStudentId);
          });

        // $("#section").append(createTextInput(1, "test", "Test Placeholder"));
        // propogation
        $('.add-lesson-icon').on(
          'click',
          function() {
            const $item = $(this);
            google.script.run
              .withSuccessHandler(displayLessons)
              // .withFailureHandler(showLessonError)
              .getCurrentLessonsForStudent(currentStudentId);
          });

        // propogation
        $('.delete-lesson-icon').on(
          'click',
          function() {
            const $item = $(this);
            debugger
            // google.script.run
            //   .withSuccessHandler(displayLessons)
            //   // .withFailureHandler(showLessonError)
            //   .getCurrentLessonsForStudent("testing");
          });
        // manipulate select => $('select').formSelect('methodName'); var instance = M.FormSelect.getInstance(elem);
      });

      const initialize =
        () => {
          // get/set bulk initialization data from server

          // const currentEmail = <?= Session.getActiveUser().getEmail() ?>;
          // console.log(currentEmail);
        };

      const displayCurrentLessons =
        (lessons) => {
          console.log(lessons);
          // $('#add-lessons').append(createTextInput(1, "test", "Test Placeholder"));
        };

      const displayAvailableLessons =
        (lessons) => {
          console.log(lessons);
          const lessonElements = lessons.map(x => "<li class=\"collection-item\" id=\"lesson_1\"><div>Monday: 3:00pm - 3:30pm, Piano (Private) with Lang Lang<a href=\"#!\" class=\"secondary-content\"><i class=\"add-lesson-icon material-icons green-text text-darken-2\">add_circle</i></a></div></li>")
          
          // $('#add-lessons').append(createTextInput(1, "test", "Test Placeholder"));
        };
    </script>

  </head>
  <body>
    <div class="container">

      <h1>Lessons</h1>

      <div class="card">
        <div class="card-content">
          <p id="active-email-title">You: <?= Session.getActiveUser().getEmail() ?></p>
          <ul class="tabs">
            <li class="tab"><a class="active" href="#">Student 1</a></li>
            <li class="tab"><a href="#">Student 2</a></li>
          </ul>
        </div>
      </div>

      <div class="card">
        <div class="card-content">
          <span class="card-title">Currently Enrolled Lessons</span>
          <p>Not enrolled in any lessons.</p>
          <ul class="current-lessons-list collection">
            <li class="collection-item"><div>Monday: 3:00pm - 3:30pm, Piano (Private) with Lang Lang<a href="#!" class="secondary-content"><i class="delete-lesson-icon material-icons red-text text-darken-4">delete_forever</i></a></div></li>
          </ul>
        </div>
      </div>

      <div id="add-private-lessons-card" class="card">
        <div class="card-content">
          <span class="card-title">Add a Private Lesson</span>
          <div class="input-field">
            <select class="instrument-options">
              <option value="" disabled selected>Pick an instrument</option>
              <option value="3">Drums</option>
              <option value="3">Ukulele</option>
              <option value="3">Guitar</option>
              <option value="3">Voice</option>
              <option value="3">Piano</option>
            </select>
            <label>Instrument</label>
          </div>
          <p hidden>No matching lessons.</p>
          <ul class="available-lesson-list collection with-header">
            <li class="collection-item" id="lesson_1"><div>Monday: 3:00pm - 3:30pm, Piano (Private) with Lang Lang<a href="#!" class="secondary-content"><i class="add-lesson-icon material-icons green-text text-darken-2">add_circle</i></a></div></li>
          </ul>
        </div>
      </div>
      
      <div id="add-group-lessons-card" class="card">
        <div class="card-content">
          <span class="card-title">Add a Group Class</span>
          <div class="input-field">
            <select class="instrument-options">
              <option value="" disabled selected>Pick an instrument</option>
              <option value="1">Rock Band</option>
              <option value="2">Songwriting</option>
              <option value="3">Class Drums</option>
              <option value="3">Taylor Swift Choir</option>
              <option value="3">Class Ukulele</option>
              <option value="3">Class Guitar</option>
              <option value="3">Class Voice</option>
              <option value="3">Digital Music</option>
              <option value="3">Class Piano</option>
              <option value="3">SF Jazz</option>
            </select>
            <label>Instrument</label>
          </div>
          <p hidden>No matching lessons.</p>
          <ul hidden class="available-lesson-list collection with-header">
            <li class="collection-item" id="lesson_1"><div>Monday: 3:00pm - 3:30pm, Piano (Private) with Lang Lang<a href="#!" class="secondary-content"><i class="add-lesson-icon material-icons green-text text-darken-2">add_circle</i></a></div></li>
          </ul>
        </div>
      </div>
      
      <div id="display-alert" class="modal">
        <div class="modal-content">
          <h4>Modal Header</h4>
          <p>A bunch of text</p>
        </div>
        <div class="modal-footer">
          <a href="#!" class="modal-close waves-effect waves-green btn-flat">Agree</a>
        </div>
      </div>
      
    </div>
  </body>
</html>
