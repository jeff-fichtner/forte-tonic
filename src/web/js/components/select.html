<script>
    class Select {
        constructor(selectId, defaultOptionsText = null, noOptionsText = null, options = [], onChangeFunction = null) {
            this.select = document.getElementById(selectId); // Get the select element by ID
            this.onChangeFunction = onChangeFunction ?? (event => { }); // Store the change event handler
            this.defaultOptionsText = defaultOptionsText || 'Select an option'; // Default text for the select options
            this.noOptionsText = noOptionsText || 'No options available'; // Default text when no options are available

            this.populateOptions(options); // Populate the select with options

            this.select.addEventListener('change', this.onChangeFunction);
        }

        // getSelectedOption
        getSelectedOption() {
            return this.select.value; // Return the currently selected option value
        }

        // setSelectedOption
        setSelectedOption(value) {
            this.select.value = value; // Set the selected option by value
            this.refresh();
        }

        clearSelectedOption() {
            this.setSelectedOption(''); // Clear the selected option
        }

        refresh() {
            this.populateOptions(this.options);
        }

        populateOptions(newOptions, forceRefresh = false) {
            console.log(`Populating options for select: ${this.select.id}`, JSON.stringify(newOptions));
            this.options = newOptions; // Update the options

            const optionTextToUse = this.options.length > 0
                ? this.defaultOptionsText
                : this.noOptionsText
            console.log(`There are${(this.options.length > 0) ? '' : "n't"} options, using: ${optionTextToUse}`);

            // get current selected option
            const currentSelectedValue = this.getSelectedOption();
            console.log(`Current selected value: ${currentSelectedValue}`);

            // clear existing options
            this.select.innerHTML = '';

            // create a default option
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = optionTextToUse;
            this.select.appendChild(defaultOption);

            // populate new options
            newOptions.forEach((option) => {
                const opt = document.createElement('option');
                opt.value = option.value;
                opt.textContent = option.label;

                if (!forceRefresh && currentSelectedValue && option.value == currentSelectedValue) {
                    opt.selected = true;
                }
                this.select.appendChild(opt);
            });

            M.FormSelect.init(this.select, {
                classes: this.select.id,
                dropdownOptions: {
                    alignment: 'left',
                    coverTrigger: false,
                    constrainWidth: false
                }
            });
        }
    }
</script>