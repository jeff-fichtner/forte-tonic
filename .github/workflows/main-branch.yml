# GitHub Actions Workflow for Main Branch
# ========================================
#
# Purpose: Test and validate main branch (production)
# 
# Workflow:
# 1. Run linting
# 2. Run formatting check
# 3. Run tests
#
# This ensures production code quality before deployment.

name: 'Main Branch - Test and Validate'

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test-and-validate:
    name: 'Test and Validate'
    runs-on: ubuntu-latest
    
    steps:
    - name: 'Checkout code'
      uses: actions/checkout@v4
    
    - name: 'Setup Node.js'
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
    
    - name: 'Install dependencies'
      run: npm ci
    
    - name: 'Run linting'
      run: npm run lint
    
    - name: 'Run formatting check'
      run: npm run format:check
    
    - name: 'Run tests'
      run: npm test
    
    - name: 'Summary'
      if: success()
      run: |
        echo ""
        echo "‚úÖ MAIN BRANCH VALIDATION PASSED!"
        echo "================================="
        echo "‚úÖ Linting: PASSED"
        echo "‚úÖ Formatting: PASSED"
        echo "‚úÖ Tests: PASSED"
        echo "üöÄ Ready for production deployment"
        echo "================================="
    
    - name: 'Failure summary'
      if: failure()
      run: |
        echo ""
        echo "‚ùå MAIN BRANCH VALIDATION FAILED!"
        echo "================================="
        echo "Fix the issues before merging to main."
        echo "================================="
